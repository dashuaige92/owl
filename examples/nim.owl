bool running
int[] stacks = [3, 4, 5]

bool gameOver() {
    int s
    for s in stacks {
        if (s != 0) {
            return false
        }
    }
    return true
}

machine nim = {
    node move

    enter(move) {
        print("Current stacks:")
        int s
        for s in stacks {
            print(toString(s) + " ")
        }
        print("\n")
        print("Remove X chips from stack Y (X, Y): ")
    }

    # Need regex support
    move("(\d+),\s+(\d+)") -> move {
        int chips = toInt(1)
        int s = toInt(2)

        if (stacks[s] < chips) {
            return
        }
        # stacks[s] -= chips
        if (gameOver()) {
            print("You win!")
            running = false
        }
    }

    move() -> move {
        print("Invalid input")
    }
}

while (running) {
    nim.step(input(""))
}
